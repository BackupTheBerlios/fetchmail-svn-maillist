From svn at mknod.org  Tue Dec  4 16:00:25 2007
From: svn at mknod.org (svn at mknod.org)
Date: Tue,  4 Dec 2007 09:00:25 -0600 (CST)
Subject: [fetchmail-svn] r5140 - branches/BRANCH_6-3
Message-ID: <20071204150025.4A385218002@mknod.org>

Author: m-a
Date: 2007-12-04 09:00:24 -0600 (Tue, 04 Dec 2007)
New Revision: 5140

Modified:
   branches/BRANCH_6-3/TODO.txt
Log:
Add one more debian bug to 6.4 TODOs.

Modified: branches/BRANCH_6-3/TODO.txt
===================================================================
--- branches/BRANCH_6-3/TODO.txt	2007-11-28 00:57:43 UTC (rev 5139)
+++ branches/BRANCH_6-3/TODO.txt	2007-12-04 15:00:24 UTC (rev 5140)
@@ -27,6 +27,9 @@
   <simpkins at cisco.com> around Nov 2nd)?
 
 6.4:
+- Debian Bug #454291 fetchmail --quit: should check, that pid file 
+  really contains pid of fetchmail process (Dmitry Nezhevenko)
+  => use fcntl() lock?
 - download only messages whose headers match a filter (by Toby, Usenet
   Nov 2007 de.comm.software.mailserver
   Message-ID: <1195033726.123704.296060 at k79g2000hse.googlegroups.com>)



From svn at mknod.org  Sun Dec  9 12:00:27 2007
From: svn at mknod.org (svn at mknod.org)
Date: Sun,  9 Dec 2007 05:00:27 -0600 (CST)
Subject: [fetchmail-svn] r5141 - branches/BRANCH_6-3
Message-ID: <20071209110027.D7DFD218002@mknod.org>

Author: m-a
Date: 2007-12-09 05:00:27 -0600 (Sun, 09 Dec 2007)
New Revision: 5141

Modified:
   branches/BRANCH_6-3/Doxyfile
Log:
Update for newer doxygen version.

Modified: branches/BRANCH_6-3/Doxyfile
===================================================================
--- branches/BRANCH_6-3/Doxyfile	2007-12-04 15:00:24 UTC (rev 5140)
+++ branches/BRANCH_6-3/Doxyfile	2007-12-09 11:00:27 UTC (rev 5141)
@@ -1,4 +1,4 @@
-# Doxyfile 1.4.4
+# Doxyfile 1.5.3
 
 # This file describes the settings to be used by the documentation system
 # doxygen (www.doxygen.org) for a project
@@ -14,6 +14,14 @@
 # Project related configuration options
 #---------------------------------------------------------------------------
 
+# This tag specifies the encoding used for all characters in the config file that 
+# follow. The default is UTF-8 which is also the encoding used for all text before 
+# the first occurrence of this tag. Doxygen uses libiconv (or the iconv built into 
+# libc) for the transcoding. See http://www.gnu.org/software/libiconv for the list of 
+# possible encodings.
+
+DOXYFILE_ENCODING      = UTF-8
+
 # The PROJECT_NAME tag is a single word (or a sequence of words surrounded 
 # by quotes) that should identify the project.
 
@@ -45,24 +53,14 @@
 # documentation generated by doxygen is written. Doxygen will use this 
 # information to generate all constant output in the proper language. 
 # The default language is English, other supported languages are: 
-# Brazilian, Catalan, Chinese, Chinese-Traditional, Croatian, Czech, Danish, 
-# Dutch, Finnish, French, German, Greek, Hungarian, Italian, Japanese, 
-# Japanese-en (Japanese with English messages), Korean, Korean-en, Norwegian, 
-# Polish, Portuguese, Romanian, Russian, Serbian, Slovak, Slovene, Spanish, 
-# Swedish, and Ukrainian.
+# Afrikaans, Arabic, Brazilian, Catalan, Chinese, Chinese-Traditional, 
+# Croatian, Czech, Danish, Dutch, Finnish, French, German, Greek, Hungarian, 
+# Italian, Japanese, Japanese-en (Japanese with English messages), Korean, 
+# Korean-en, Lithuanian, Norwegian, Polish, Portuguese, Romanian, Russian, 
+# Serbian, Slovak, Slovene, Spanish, Swedish, and Ukrainian.
 
 OUTPUT_LANGUAGE        = English
 
-# This tag can be used to specify the encoding used in the generated output. 
-# The encoding is not always determined by the language that is chosen, 
-# but also whether or not the output is meant for Windows or non-Windows users. 
-# In case there is a difference, setting the USE_WINDOWS_ENCODING tag to YES 
-# forces the Windows encoding (this is the default for the Windows binary), 
-# whereas setting the tag to NO uses a Unix-style encoding (the default for 
-# all platforms other than Windows).
-
-USE_WINDOWS_ENCODING   = NO
-
 # If the BRIEF_MEMBER_DESC tag is set to YES (the default) Doxygen will 
 # include brief member descriptions after the members that are listed in 
 # the file and class documentation (similar to JavaDoc). 
@@ -135,11 +133,19 @@
 # If the JAVADOC_AUTOBRIEF tag is set to YES then Doxygen 
 # will interpret the first line (until the first dot) of a JavaDoc-style 
 # comment as the brief description. If set to NO, the JavaDoc 
-# comments will behave just like the Qt-style comments (thus requiring an 
-# explicit @brief command for a brief description.
+# comments will behave just like regular Qt-style comments 
+# (thus requiring an explicit @brief command for a brief description.)
 
 JAVADOC_AUTOBRIEF      = NO
 
+# If the QT_AUTOBRIEF tag is set to YES then Doxygen will 
+# interpret the first line (until the first dot) of a Qt-style 
+# comment as the brief description. If set to NO, the comments 
+# will behave just like regular Qt-style comments (thus requiring 
+# an explicit \brief command for a brief description.)
+
+QT_AUTOBRIEF           = NO
+
 # The MULTILINE_CPP_IS_BRIEF tag can be set to YES to make Doxygen 
 # treat a multi-line C++ special comment block (i.e. a block of //! or /// 
 # comments) as a brief description. This used to be the default behaviour. 
@@ -161,13 +167,6 @@
 
 INHERIT_DOCS           = YES
 
-# If member grouping is used in the documentation and the DISTRIBUTE_GROUP_DOC 
-# tag is set to YES, then doxygen will reuse the documentation of the first 
-# member in the group (if any) for the other members of the group. By default 
-# all members of a group must be documented explicitly.
-
-DISTRIBUTE_GROUP_DOC   = NO
-
 # If the SEPARATE_MEMBER_PAGES tag is set to YES, then doxygen will produce 
 # a new page for each member. If set to NO, the documentation of a member will 
 # be part of the file/class/namespace that contains it.
@@ -195,13 +194,34 @@
 
 OPTIMIZE_OUTPUT_FOR_C  = YES
 
-# Set the OPTIMIZE_OUTPUT_JAVA tag to YES if your project consists of Java sources 
-# only. Doxygen will then generate output that is more tailored for Java. 
+# Set the OPTIMIZE_OUTPUT_JAVA tag to YES if your project consists of Java 
+# sources only. Doxygen will then generate output that is more tailored for Java. 
 # For instance, namespaces will be presented as packages, qualified scopes 
 # will look different, etc.
 
 OPTIMIZE_OUTPUT_JAVA   = NO
 
+# If you use STL classes (i.e. std::string, std::vector, etc.) but do not want to 
+# include (a tag file for) the STL sources as input, then you should 
+# set this tag to YES in order to let doxygen match functions declarations and 
+# definitions whose arguments contain STL classes (e.g. func(std::string); v.s. 
+# func(std::string) {}). This also make the inheritance and collaboration 
+# diagrams that involve STL classes more complete and accurate.
+
+BUILTIN_STL_SUPPORT    = NO
+
+# If you use Microsoft's C++/CLI language, you should set this option to YES to
+# enable parsing support.
+
+CPP_CLI_SUPPORT        = NO
+
+# If member grouping is used in the documentation and the DISTRIBUTE_GROUP_DOC 
+# tag is set to YES, then doxygen will reuse the documentation of the first 
+# member in the group (if any) for the other members of the group. By default 
+# all members of a group must be documented explicitly.
+
+DISTRIBUTE_GROUP_DOC   = NO
+
 # Set the SUBGROUPING tag to YES (the default) to allow class member groups of 
 # the same type (for instance a group of public functions) to be put as a 
 # subgroup of that type (e.g. under the Public Functions section). Set it to 
@@ -244,6 +264,13 @@
 
 EXTRACT_LOCAL_METHODS  = NO
 
+# If this flag is set to YES, the members of anonymous namespaces will be extracted 
+# and appear in the documentation as a namespace called 'anonymous_namespace{file}', 
+# where file will be replaced with the base name of the file that contains the anonymous 
+# namespace. By default anonymous namespace are hidden.
+
+EXTRACT_ANON_NSPACES   = NO
+
 # If the HIDE_UNDOC_MEMBERS tag is set to YES, Doxygen will hide all 
 # undocumented members of documented classes, files or namespaces. 
 # If set to NO (the default) these members will be included in the 
@@ -376,7 +403,7 @@
 
 # If the sources in your project are distributed over multiple directories 
 # then setting the SHOW_DIRECTORIES tag to YES will show the directory hierarchy 
-# in the documentation. The default is YES.
+# in the documentation. The default is NO.
 
 SHOW_DIRECTORIES       = YES
 
@@ -385,7 +412,7 @@
 # version control system). Doxygen will invoke the program by executing (via 
 # popen()) the command <command> <input-file>, where <command> is the value of 
 # the FILE_VERSION_FILTER tag, and <input-file> is the name of an input file 
-# provided by doxygen. Whatever the progam writes to standard output 
+# provided by doxygen. Whatever the program writes to standard output 
 # is used as the file version. See the manual for examples.
 
 FILE_VERSION_FILTER    = 
@@ -433,7 +460,7 @@
 # $version, which will be replaced by the version of the file (if it could 
 # be obtained via FILE_VERSION_FILTER)
 
-WARN_FORMAT            = "$file:$line: $text"
+WARN_FORMAT            = "$file:$line: $text  "
 
 # The WARN_LOGFILE tag can be used to specify a file to which warning 
 # and error messages should be written. If left blank the output is written 
@@ -452,14 +479,21 @@
 
 INPUT                  = 
 
+# This tag can be used to specify the character encoding of the source files that 
+# doxygen parses. Internally doxygen uses the UTF-8 encoding, which is also the default 
+# input encoding. Doxygen uses libiconv (or the iconv built into libc) for the transcoding. 
+# See http://www.gnu.org/software/libiconv for the list of possible encodings.
+
+INPUT_ENCODING         = UTF-8
+
 # If the value of the INPUT tag contains directories, you can use the 
 # FILE_PATTERNS tag to specify one or more wildcard pattern (like *.cpp 
 # and *.h) to filter out the source-files in the directories. If left 
 # blank the following patterns are tested: 
 # *.c *.cc *.cxx *.cpp *.c++ *.java *.ii *.ixx *.ipp *.i++ *.inl *.h *.hh *.hxx 
-# *.hpp *.h++ *.idl *.odl *.cs *.php *.php3 *.inc *.m *.mm
+# *.hpp *.h++ *.idl *.odl *.cs *.php *.php3 *.inc *.m *.mm *.py
 
-FILE_PATTERNS          = 
+FILE_PATTERNS          = *.c *.h *.l *.y
 
 # The RECURSIVE tag can be used to turn specify whether or not subdirectories 
 # should be searched for input files as well. Possible values are YES and NO. 
@@ -487,6 +521,13 @@
 
 EXCLUDE_PATTERNS       = 
 
+# The EXCLUDE_SYMBOLS tag can be used to specify one or more symbol names 
+# (namespaces, classes, functions, etc.) that should be excluded from the output. 
+# The symbol name can be a fully qualified name, a word, or if the wildcard * is used, 
+# a substring. Examples: ANamespace, AClass, AClass::ANamespace, ANamespace::*Test
+
+EXCLUDE_SYMBOLS        = 
+
 # The EXAMPLE_PATH tag can be used to specify one or more files or 
 # directories that contain example code fragments that are included (see 
 # the \include command).
@@ -545,7 +586,9 @@
 # If the SOURCE_BROWSER tag is set to YES then a list of source files will 
 # be generated. Documented entities will be cross-referenced with these sources. 
 # Note: To get rid of all source code in the generated output, make sure also 
-# VERBATIM_HEADERS is set to NO.
+# VERBATIM_HEADERS is set to NO. If you have enabled CALL_GRAPH or CALLER_GRAPH 
+# then you must also enable this option. If you don't then doxygen will produce 
+# a warning and turn it on anyway
 
 SOURCE_BROWSER         = NO
 
@@ -572,6 +615,13 @@
 
 REFERENCES_RELATION    = YES
 
+# If the REFERENCES_LINK_SOURCE tag is set to YES (the default)
+# and SOURCE_BROWSER tag is set to YES, then the hyperlinks from
+# functions in REFERENCES_RELATION and REFERENCED_BY_RELATION lists will
+# link to the source code.  Otherwise they will link to the documentstion.
+
+REFERENCES_LINK_SOURCE = YES
+
 # If the USE_HTAGS tag is set to YES then the references to source code 
 # will point to the HTML generated by the htags(1) tool instead of doxygen 
 # built-in source browser. The htags tool is part of GNU's global source 
@@ -664,6 +714,14 @@
 
 GENERATE_HTMLHELP      = NO
 
+# If the HTML_DYNAMIC_SECTIONS tag is set to YES then the generated HTML 
+# documentation will contain sections that can be hidden and shown after the 
+# page has loaded. For this to work a browser that supports 
+# JavaScript and DHTML is required (for instance Mozilla 1.0+, Firefox 
+# Netscape 6.0+, Internet explorer 5.0+, Konqueror, or Safari).
+
+HTML_DYNAMIC_SECTIONS  = NO
+
 # If the GENERATE_HTMLHELP tag is set to YES, the CHM_FILE tag can 
 # be used to specify the file name of the resulting .chm file. You 
 # can add a path in front of the file if the result should not be 
@@ -966,7 +1024,7 @@
 
 # If the EXPAND_ONLY_PREDEF and MACRO_EXPANSION tags are both set to YES 
 # then the macro expansion is limited to the macros specified with the 
-# PREDEFINED and EXPAND_AS_PREDEFINED tags.
+# PREDEFINED and EXPAND_AS_DEFINED tags.
 
 EXPAND_ONLY_PREDEF     = NO
 
@@ -1069,6 +1127,14 @@
 
 CLASS_DIAGRAMS         = YES
 
+# You can define message sequence charts within doxygen comments using the \msc 
+# command. Doxygen will then run the mscgen tool (see http://www.mcternan.me.uk/mscgen/) to 
+# produce the chart and insert it in the documentation. The MSCGEN_PATH tag allows you to 
+# specify the directory where the mscgen tool resides. If left empty the tool is assumed to 
+# be found in the default search path.
+
+MSCGEN_PATH            = 
+
 # If set to YES, the inheritance and collaboration graphs will hide 
 # inheritance and usage relations if the target is undocumented 
 # or is not a class.
@@ -1126,7 +1192,7 @@
 
 INCLUDED_BY_GRAPH      = YES
 
-# If the CALL_GRAPH and HAVE_DOT tags are set to YES then doxygen will 
+# If the CALL_GRAPH, SOURCE_BROWSER and HAVE_DOT tags are set to YES then doxygen will 
 # generate a call dependency graph for every global function or class method. 
 # Note that enabling this option will significantly increase the time of a run. 
 # So in most cases it will be better to enable call graphs for selected 
@@ -1134,6 +1200,14 @@
 
 CALL_GRAPH             = NO
 
+# If the CALLER_GRAPH, SOURCE_BROWSER and HAVE_DOT tags are set to YES then doxygen will 
+# generate a caller dependency graph for every global function or class method. 
+# Note that enabling this option will significantly increase the time of a run. 
+# So in most cases it will be better to enable caller graphs for selected 
+# functions only using the \callergraph command.
+
+CALLER_GRAPH           = NO
+
 # If the GRAPHICAL_HIERARCHY and HAVE_DOT tags are set to YES then doxygen 
 # will graphical hierarchy of all classes instead of a textual one.
 
@@ -1163,31 +1237,23 @@
 
 DOTFILE_DIRS           = 
 
-# The MAX_DOT_GRAPH_WIDTH tag can be used to set the maximum allowed width 
-# (in pixels) of the graphs generated by dot. If a graph becomes larger than 
-# this value, doxygen will try to truncate the graph, so that it fits within 
-# the specified constraint. Beware that most browsers cannot cope with very 
-# large images.
+# The MAX_DOT_GRAPH_MAX_NODES tag can be used to set the maximum number of 
+# nodes that will be shown in the graph. If the number of nodes in a graph 
+# becomes larger than this value, doxygen will truncate the graph, which is 
+# visualized by representing a node as a red box. Note that doxygen if the number 
+# of direct children of the root node in a graph is already larger than 
+# MAX_DOT_GRAPH_NOTES then the graph will not be shown at all. Also note 
+# that the size of a graph can be further restricted by MAX_DOT_GRAPH_DEPTH.
 
-MAX_DOT_GRAPH_WIDTH    = 1024
+DOT_GRAPH_MAX_NODES    = 50
 
-# The MAX_DOT_GRAPH_HEIGHT tag can be used to set the maximum allows height 
-# (in pixels) of the graphs generated by dot. If a graph becomes larger than 
-# this value, doxygen will try to truncate the graph, so that it fits within 
-# the specified constraint. Beware that most browsers cannot cope with very 
-# large images.
-
-MAX_DOT_GRAPH_HEIGHT   = 1024
-
 # The MAX_DOT_GRAPH_DEPTH tag can be used to set the maximum depth of the 
 # graphs generated by dot. A depth value of 3 means that only nodes reachable 
 # from the root by following a path via at most 3 edges will be shown. Nodes 
 # that lay further from the root node will be omitted. Note that setting this 
 # option to 1 or 2 may greatly reduce the computation time needed for large 
-# code bases. Also note that a graph may be further truncated if the graph's 
-# image dimensions are not sufficient to fit the graph (see MAX_DOT_GRAPH_WIDTH 
-# and MAX_DOT_GRAPH_HEIGHT). If 0 is used for the depth value (the default), 
-# the graph is not depth-constrained.
+# code bases. Also note that the size of a graph can be further restricted by 
+# DOT_GRAPH_MAX_NODES. Using a depth of 0 means no depth restriction.
 
 MAX_DOT_GRAPH_DEPTH    = 0
 



From svn at mknod.org  Sun Dec  9 12:00:35 2007
From: svn at mknod.org (svn at mknod.org)
Date: Sun,  9 Dec 2007 05:00:35 -0600 (CST)
Subject: [fetchmail-svn] r5142 - branches/BRANCH_6-3
Message-ID: <20071209110035.A7772218003@mknod.org>

Author: m-a
Date: 2007-12-09 05:00:35 -0600 (Sun, 09 Dec 2007)
New Revision: 5142

Modified:
   branches/BRANCH_6-3/rcfile_y.y
   branches/BRANCH_6-3/tls.c
Log:
Doxygen-related comment fixes.

Modified: branches/BRANCH_6-3/rcfile_y.y
===================================================================
--- branches/BRANCH_6-3/rcfile_y.y	2007-12-09 11:00:27 UTC (rev 5141)
+++ branches/BRANCH_6-3/rcfile_y.y	2007-12-09 11:00:35 UTC (rev 5142)
@@ -383,8 +383,9 @@
     prc_errflag++;
 }
 
-int prc_filecheck(const char *pathname, const flag securecheck)
-/* check that a configuration file is secure */
+/** check that a configuration file is secure, returns PS_* status codes */
+int prc_filecheck(const char *pathname,
+		  const flag securecheck /** shortcuts permission, filetype and uid tests if false */)
 {
 #ifndef __EMX__
     struct stat statbuf;

Modified: branches/BRANCH_6-3/tls.c
===================================================================
--- branches/BRANCH_6-3/tls.c	2007-12-09 11:00:27 UTC (rev 5141)
+++ branches/BRANCH_6-3/tls.c	2007-12-09 11:00:35 UTC (rev 5142)
@@ -1,6 +1,6 @@
 /** \file tls.c - collect common TLS functionality 
  * \author Matthias Andree
- * \year 2006
+ * \date 2006
  */
 
 #include "fetchmail.h"



From svn at mknod.org  Wed Dec 26 15:03:22 2007
From: svn at mknod.org (svn at mknod.org)
Date: Wed, 26 Dec 2007 08:03:22 -0600 (CST)
Subject: [fetchmail-svn] r5143 - branches/BRANCH_6-3
Message-ID: <20071226140322.420E36B0CD8@mknod.org>

Author: m-a
Date: 2007-12-26 08:03:22 -0600 (Wed, 26 Dec 2007)
New Revision: 5143

Modified:
   branches/BRANCH_6-3/TODO.txt
Log:
Rearrange according to importance.

Modified: branches/BRANCH_6-3/TODO.txt
===================================================================
--- branches/BRANCH_6-3/TODO.txt	2007-12-09 11:00:35 UTC (rev 5142)
+++ branches/BRANCH_6-3/TODO.txt	2007-12-26 14:03:22 UTC (rev 5143)
@@ -1,26 +1,33 @@
-soon:
-- BerliOS Bug #11576, thread on fetchmail users "Invalid SSL certificate" by
-  Philip Susi, SSL negotiation does not use ERR_error_string(3ssl) to report
-  errors in a readable way, we just report socket errors with no good reason.
-- find a solution for the "invalid header" discards message problem
-  (escape headers and stuff reminder into body)
-- https://bugzilla.novell.com/show_bug.cgi?id=246829 - fetchmail lost some mail
-  (5XX error code in contradiction with manual?)
-- http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=432618
-  * write a table of combinations of TLS/SSL options
-- add To: header to warning mails (authfail for instance)
-- add Message-ID: header and other SHOULD headers to warning mails?
+soon - MUST:
 - BerliOS Bug #11797, imap_mark_seen doesn't consider expunged messages
 - BerliOS Bug #10972, Fetchmail refetches big messages repeatedly (SMTP listener
   issue)
 - report multiline SMTP errors properly (sample in private mail from 
   Earl Chew, 2007-07-30T02:28)
 - publish SA-2007-02 after release
-- Debian Bug#449179, smbutil.c:90: unicodeToString: Assertion `len+1 < sizeof
-  buf' failed, from Stepan Golosunov <stepan at golosunov.pp.ru>
 - Peter O'Gorman 2007-10-31 fetchmail-6.3.8 portability patches [-devel list]
 - Debian Bug #452907 .fetchmailrc not permitted to be a symlink
   (restriction not mentioned in manpage, also affects .idfile)
+
+soon - SHOULD:
+- BerliOS Bug #11576, thread on fetchmail users "Invalid SSL certificate" by
+  Philip Susi, SSL negotiation does not use ERR_error_string(3ssl) to report
+  errors in a readable way, we just report socket errors with no good reason.
+- http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=432618
+  * write a table of combinations of TLS/SSL options
+- add To: header to warning mails (authfail for instance)
+- Debian Bug#449179, smbutil.c:90: unicodeToString: Assertion `len+1 < sizeof
+  buf' failed, from Stepan Golosunov <stepan at golosunov.pp.ru>
+
+soon - MAY:
+- https://bugzilla.novell.com/show_bug.cgi?id=246829 - fetchmail lost some mail
+  (5XX error code in contradiction with manual?)
+
+soon - after 6.3.9:
+- find a solution for the "invalid header" discards message problem
+  (escape headers and stuff reminder into body)
+- add Message-ID: header and other SHOULD headers to warning mails?
+
 questionable:
 - Convert POP3 UIDs to X-UIDL?
 - fetch IMAP message in one go (fetchmail-devel by Adam Simpkins



From svn at mknod.org  Wed Dec 26 15:18:18 2007
From: svn at mknod.org (svn at mknod.org)
Date: Wed, 26 Dec 2007 08:18:18 -0600 (CST)
Subject: [fetchmail-svn] r5144 - branches/BRANCH_6-3
Message-ID: <20071226141818.1339E6B0CCE@mknod.org>

Author: m-a
Date: 2007-12-26 08:18:17 -0600 (Wed, 26 Dec 2007)
New Revision: 5144

Modified:
   branches/BRANCH_6-3/NEWS
   branches/BRANCH_6-3/TODO.txt
   branches/BRANCH_6-3/rcfile_y.y
Log:
.fetchmailrc/.fetchids may now be symlinks, Debian Bug#452907 (Roger Leigh).

Modified: branches/BRANCH_6-3/NEWS
===================================================================
--- branches/BRANCH_6-3/NEWS	2007-12-26 14:03:22 UTC (rev 5143)
+++ branches/BRANCH_6-3/NEWS	2007-12-26 14:18:17 UTC (rev 5144)
@@ -66,6 +66,9 @@
 * No longer complain about invalid sslproto "" when POP3 CAPA probe fails.
   Fixes Debian Bug#421446 (Holger Leskien), Novell Bug #247233 (Jon Nelson).
   Thanks to Matthias Strau? for a configuration to reproduce the issue.
+* Allow .fetchmailrc and .fetchids to be symlinks, as the manpage does not
+  document they aren't allowed - fixes Debian Bug #452907 (Roger Leigh).
+  TOCTOU race persists.
 
 # CHANGES:
 * Removed dead FETCHMAIL_DEBUG code from fetchmail.h that was disabled by 

Modified: branches/BRANCH_6-3/TODO.txt
===================================================================
--- branches/BRANCH_6-3/TODO.txt	2007-12-26 14:03:22 UTC (rev 5143)
+++ branches/BRANCH_6-3/TODO.txt	2007-12-26 14:18:17 UTC (rev 5144)
@@ -6,8 +6,6 @@
   Earl Chew, 2007-07-30T02:28)
 - publish SA-2007-02 after release
 - Peter O'Gorman 2007-10-31 fetchmail-6.3.8 portability patches [-devel list]
-- Debian Bug #452907 .fetchmailrc not permitted to be a symlink
-  (restriction not mentioned in manpage, also affects .idfile)
 
 soon - SHOULD:
 - BerliOS Bug #11576, thread on fetchmail users "Invalid SSL certificate" by
@@ -18,6 +16,7 @@
 - add To: header to warning mails (authfail for instance)
 - Debian Bug#449179, smbutil.c:90: unicodeToString: Assertion `len+1 < sizeof
   buf' failed, from Stepan Golosunov <stepan at golosunov.pp.ru>
+- Fix TOCTOU race around prc_filecheck*
 
 soon - MAY:
 - https://bugzilla.novell.com/show_bug.cgi?id=246829 - fetchmail lost some mail

Modified: branches/BRANCH_6-3/rcfile_y.y
===================================================================
--- branches/BRANCH_6-3/rcfile_y.y	2007-12-26 14:03:22 UTC (rev 5143)
+++ branches/BRANCH_6-3/rcfile_y.y	2007-12-26 14:18:17 UTC (rev 5144)
@@ -404,7 +404,7 @@
        process, it must have permissions no greater than 600, and it must not 
        be a symbolic link.  We check these conditions here. */
 
-    if (lstat(pathname, &statbuf) < 0) {
+    if (stat(pathname, &statbuf) < 0) {
 	if (errno == ENOENT) 
 	    return(PS_SUCCESS);
 	else {



From svn at mknod.org  Wed Dec 26 15:37:09 2007
From: svn at mknod.org (svn at mknod.org)
Date: Wed, 26 Dec 2007 08:37:09 -0600 (CST)
Subject: [fetchmail-svn] r5145 - in branches/BRANCH_6-3: . KAME libesmtp m4
Message-ID: <20071226143709.8393A6B0CCE@mknod.org>

Author: m-a
Date: 2007-12-26 08:37:09 -0600 (Wed, 26 Dec 2007)
New Revision: 5145

Modified:
   branches/BRANCH_6-3/KAME/getnameinfo.c
   branches/BRANCH_6-3/Makefile.am
   branches/BRANCH_6-3/NEWS
   branches/BRANCH_6-3/TODO.txt
   branches/BRANCH_6-3/configure.ac
   branches/BRANCH_6-3/libesmtp/gethostbyname.c
   branches/BRANCH_6-3/m4/gethostbyname_r.m4
   branches/BRANCH_6-3/smbencrypt.c
Log:
Merge portability patch from Peter O'Gorman, fetchmail-devel 2007-10-31.
This requires some minor fixes though.

Modified: branches/BRANCH_6-3/KAME/getnameinfo.c
===================================================================
--- branches/BRANCH_6-3/KAME/getnameinfo.c	2007-12-26 14:18:17 UTC (rev 5144)
+++ branches/BRANCH_6-3/KAME/getnameinfo.c	2007-12-26 14:37:09 UTC (rev 5145)
@@ -291,8 +291,11 @@
 				    hostlen) == NULL)
 					return EAI_SYSTEM;
 #else
-				if (afd->a_af == AF_INET)
-				    strlcpy(host, inet_ntoa(addr), hostlen);
+				if (afd->a_af == AF_INET) {
+				    struct in_addr addr_tmp;
+				    addr_tmp.s_addr = addr;
+				    strlcpy(host, inet_ntoa(addr_tmp), hostlen);
+				}
 				else
 				    return EAI_FAMILY;
 #endif

Modified: branches/BRANCH_6-3/Makefile.am
===================================================================
--- branches/BRANCH_6-3/Makefile.am	2007-12-26 14:18:17 UTC (rev 5144)
+++ branches/BRANCH_6-3/Makefile.am	2007-12-26 14:37:09 UTC (rev 5145)
@@ -3,9 +3,7 @@
 SUBDIRS=		m4 po
 AUTOMAKE_OPTIONS=	1.8 foreign no-dist-gzip dist-bzip2
 
-AM_CFLAGS=		@CEFLAGS@
-AM_CPPFLAGS=		@CPFLAGS@ -I$(srcdir)/libesmtp
-AM_LDFLAGS=		@LDEFLAGS@
+AM_CPPFLAGS=		-I$(srcdir)/libesmtp
 ACLOCAL_AMFLAGS=	-I m4 -I m4-local
 AM_YFLAGS=		-d
 BUILT_SOURCES=		rcfile_y.h

Modified: branches/BRANCH_6-3/NEWS
===================================================================
--- branches/BRANCH_6-3/NEWS	2007-12-26 14:18:17 UTC (rev 5144)
+++ branches/BRANCH_6-3/NEWS	2007-12-26 14:37:09 UTC (rev 5145)
@@ -75,6 +75,21 @@
   default with no switches in configure to enable it. However, the macro would 
   have been prone to a symlink attack. Found by Nico Golde.
 
+* Include the typedef for int16 in the #ifndef _AIX in smbencrypt.c (Peter
+  O'Gorman)
+* Correct check for u_int32_t in configure.ac (seems to be typedef'ed in
+  namser.h on some platforms.) (Peter O'Gorman)
+* In configure.ac change all CPFLAGS to CPPFLAGS, CEFLAGS to CFLAGS and LDEFLAGS
+  to LDFLAGS otherwise the results of some tests (additional -L and -I flags) do
+  not get used for later tests causing incorrect configure results. Makefile.am
+  was also changed to reflect this. (Peter O'Gorman)
+* m4/gethostbyname_r.m4 does AC_TRY_COMPILE, which unfortunately can pass even
+  if there is no gethostbyname_r. Changed to AC_TRY_LINK. (Peter O'Gorman)
+* __attribute__ ((unused)) is a gccism, removed from libesmtp/gethostbyname.c.
+  (Peter O'Gorman)
+* In KAME/getnameinfo.c it's best to use the correct argument to inet_ntoa.
+  (Peter O'Gorman)
+
 # DOCUMENTATION:
 * Add fetchmail-SA-2007-02.txt
 * Re-add two lines to the manual page that had accidentally become comments 
@@ -89,6 +104,8 @@
 * Spanish (Javier Fern?ndez-Sanguino Pe?a, Matthias Andree)
 * Vietnamese (Clytie Siddall)
 
+
+
 fetchmail 6.3.8 (released 2007-04-06):
 
 # SECURITY STRENGTHENING:

Modified: branches/BRANCH_6-3/TODO.txt
===================================================================
--- branches/BRANCH_6-3/TODO.txt	2007-12-26 14:18:17 UTC (rev 5144)
+++ branches/BRANCH_6-3/TODO.txt	2007-12-26 14:37:09 UTC (rev 5145)
@@ -5,7 +5,6 @@
 - report multiline SMTP errors properly (sample in private mail from 
   Earl Chew, 2007-07-30T02:28)
 - publish SA-2007-02 after release
-- Peter O'Gorman 2007-10-31 fetchmail-6.3.8 portability patches [-devel list]
 
 soon - SHOULD:
 - BerliOS Bug #11576, thread on fetchmail users "Invalid SSL certificate" by

Modified: branches/BRANCH_6-3/configure.ac
===================================================================
--- branches/BRANCH_6-3/configure.ac	2007-12-26 14:18:17 UTC (rev 5144)
+++ branches/BRANCH_6-3/configure.ac	2007-12-26 14:37:09 UTC (rev 5145)
@@ -49,11 +49,17 @@
 AC_TYPE_SIZE_T
 AC_TYPE_PID_T
 AC_TYPE_SIGNAL
-AC_CHECK_TYPE(u_int32_t,unsigned int)
 AC_CHECK_HEADERS([unistd.h termios.h termio.h sgtty.h stdarg.h \
 	sys/itimer.h fcntl.h sys/fcntl.h memory.h sys/wait.h \
-	arpa/inet.h arpa/nameser.h netinet/in.h net/socket.h \
+	arpa/inet.h arpa/nameser.h netinet/in.h net/socket.h netdb.h \
 	sys/select.h sys/socket.h sys/time.h langinfo.h])
+AC_CHECK_TYPE(u_int32_t,,
+	AC_DEFINE(u_int32_t,unsigned int,
+		[Define to unsigned int if <sys/types.h> does not define.]),
+	[AC_INCLUDES_DEFAULT
+#ifdef HAVE_ARPA_NAMESER_H
+#include <arpa/nameser.h>
+#endif])
 AC_CHECK_HEADERS([resolv.h],,,[
 #include <sys/types.h>
 #ifdef HAVE_NETINET_IN_H
@@ -74,7 +80,7 @@
 case $target_os in
 darwin*)
     AC_MSG_NOTICE(found Darwin - Adding -DBIND_8_COMPAT to CFLAGS)
-    CPFLAGS="-DBIND_8_COMPAT"
+    CPPFLAGS="$CPPFLAGS -DBIND_8_COMPAT"
     ;;
 # Check for FreeBSD special case: more libs needed
 freebsd*)
@@ -88,7 +94,7 @@
     LIBS="$LIBS -lbsd"
     LDFLAGS=`echo $LDFLAGS | sed "s/-s //"`
     AC_MSG_NOTICE(found LynxOS - Prepending standard include path to gcc flags)
-    CPFLAGS="-I/usr/include"
+    CPPFLAGS="$CPPFLAGS -I/usr/include"
     ;;
 # Check for Rhapsody special case: it doesn't like -s
 rhapsody*)
@@ -431,13 +437,47 @@
 	[with_opie=no])
 test "$with_opie" = "yes" && AC_DEFINE(OPIE_ENABLE,1,Define if you want OPIE support compiled in)
 
-AC_SEARCH_LIBS(getaddrinfo, inet6, [AC_DEFINE(HAVE_GETADDRINFO,1,[define to 1 if you have the getaddrinfo function])])
-AC_CHECK_FUNCS(getnameinfo inet_ntop)
-AM_CONDITIONAL(NEED_GETADDRINFO, test "$ac_cv_search_getaddrinfo" != "none required")
-AM_CONDITIONAL(NEED_GETNAMEINFO, test "$ac_cv_func_getnameinfo"   != yes)
+dnl Mostly stolen from gnulib's getaddrinfo.m4
+AC_SEARCH_LIBS(getaddrinfo, [nsl socket])
+AC_CACHE_CHECK([for getaddrinfo],[fm_cv_getaddrinfo],[
+  AC_TRY_LINK([
+#include <sys/types.h>
+#ifdef HAVE_SYS_SOCKET_H
+#include <sys/socket.h>
+#endif
+#ifdef HAVE_NETDB_H
+#include <netdb.h>
+#endif
+  ], [getaddrinfo(0, 0, 0, 0);],
+    [ fm_cv_getaddrinfo=yes],
+    [ fm_cv_getaddrinfo=no ])
+])
 
+if test x"$fm_cv_getaddrinfo" = "xyes"; then  
+     AC_DEFINE(HAVE_GETADDRINFO, 1,
+      [Define to 1 if you have the getaddrinfo function.])
+fi
+
+AC_CACHE_CHECK([for getnameinfo],[fm_cv_getnameinfo],[
+  AC_TRY_LINK([
+#include <sys/types.h>
+#ifdef HAVE_SYS_SOCKET_H
+#include <sys/socket.h>
+#endif
+#ifdef HAVE_NETDB_H
+#include <netdb.h>
+#endif
+  ], [getnameinfo(NULL,0, NULL,0, NULL, 0, 0);],
+    [ fm_cv_getnameinfo=yes],
+    [ fm_cv_getnameinfo=no ])
+])
+
+AM_CONDITIONAL(NEED_GETADDRINFO, test "$fm_cv_getaddrinfo" != yes)
+AM_CONDITIONAL(NEED_GETNAMEINFO, test "$fm_cv_getnameinfo"   != yes)
+
+AC_CHECK_FUNCS(inet_ntop)
 dnl Check if getaddrinfo is async-signal-safe - most implementations aren't
-if test "$ac_cv_search_getaddrinfo" = "none required" ; then
+if test "$fm_cv_getaddrinfo" = yes ; then
     AC_MSG_CHECKING(if your getaddrinfo is async-signal-safe)
     gai_ts=no
     dnl we have getaddrinfo() - check if the OS is known to have a async-signal-safe implementation
@@ -481,23 +521,23 @@
   AS_MESSAGE(checking kerberosV for OpenBSD...)
   AC_DEFINE(HEIMDAL,1,Define if you have HEIMDAL kerberos 5)
   AC_DEFINE(KERBEROS_V5,1,Define if you have Kerberos V5)
-  CEFLAGS="$CEFLAGS -I/usr/include/kerberosV"
+  CFLAGS="$CFLAGS -I/usr/include/kerberosV"
   LIBS="$LIBS -lasn1 -lkrb5 -lcom_err -lkafs"
 elif krb5-config 2> /dev/null >/dev/null ; then
   krb5_prefix=`krb5-config --prefix krb5`
   AC_MSG_RESULT([krb5-config points to kerberosV under $krb5_prefix])
   if test -f ${krb5_prefix}/include/et/com_err.h && \
    ! test -f ${krb5_prefix}/include/com_err.h  ; then
-    CEFLAGS="$CEFLAGS -I${krb5_prefix}/include/et"
+    CFLAGS="$CFLAGS -I${krb5_prefix}/include/et"
   fi
   unset krb5_prefix
-  CEFLAGS="$CEFLAGS `krb5-config --cflags krb5`"
+  CFLAGS="$CFLAGS `krb5-config --cflags krb5`"
   LIBS="$LIBS `krb5-config --libs krb5`"
   AC_DEFINE(KERBEROS_V5)
 else
   if test "$with_kerberos5" != "yes" 
   then
-      LDEFLAGS="$LDEFLAGS -L${with_kerberos5}/lib"
+      LDFLAGS="$LDFLAGS -L${with_kerberos5}/lib"
       searchdirs="$with_kerberos5"
   else
       searchdirs="/usr/kerberos /usr/local/krb5 /usr/athena /usr"
@@ -507,7 +547,7 @@
   do AC_MSG_CHECKING([for Kerberos V in $dir])
      if test -f "$dir/include/krb5.h" || test -f "$dir/include/krb5/krb5.h"
      then
-	if test -d "$dir/include/krb5" ; then CPFLAGS="$CPFLAGS -I$dir/include/krb5" ; fi
+	if test -d "$dir/include/krb5" ; then CPPFLAGS="$CPPFLAGS -I$dir/include/krb5" ; fi
         ac_krblibs=
         if test -f "$dir/include/roken.h" || test -f "$dir/include/krb5/roken.h"
         then
@@ -516,12 +556,12 @@
           dnl Attempt to detect if we need to -ldb2 to link Heimdal
           dnl we assume we do if it is available
            AC_CHECK_LIB(db2, db_open, ac_krblibs="$ac_krblibs -ldb2", [],
-                ${LDEFLAGS})
+                ${LDFLAGS})
            AC_CHECK_LIB(des, des_string_to_key, libk5crypto=-ldes,
               AC_CHECK_LIB(ssl, MD5_Init, [],
                 AC_MSG_ERROR([DES libraries not found. Try adding --with-ssl to enable OpenSSL support]),
-                ${LDEFLAGS} ${ac_krblibs}),
-           ${LDEFLAGS} ${ac_krblibs})
+                ${LDFLAGS} ${ac_krblibs}),
+           ${LDFLAGS} ${ac_krblibs})
            AC_DEFINE(HEIMDAL)
         else
           AC_MSG_RESULT([found])
@@ -533,15 +573,15 @@
                    krb5_des_string_to_key,
                    libk5crypto=-lk5crypto,
                       AC_MSG_ERROR([Kerberos 5 DES libraries not found]),
-                   ${LDEFLAGS} ${ac_krblibs}),
-                 ${LDEFLAGS} ${ac_krblibs})
+                   ${LDFLAGS} ${ac_krblibs}),
+                 ${LDFLAGS} ${ac_krblibs})
         fi
         AC_CHECK_LIB(krb5, krb5_init_context,[],
            continue,
-           ${LDEFLAGS} ${ac_krblibs})
+           ${LDFLAGS} ${ac_krblibs})
         AC_DEFINE(KERBEROS_V5)
-        test "$dir" != "/usr" && CEFLAGS="$CEFLAGS -I$dir/include"
-        LDEFLAGS="$LDEFLAGS -L$dir/lib"
+        test "$dir" != "/usr" && CFLAGS="$CFLAGS -I$dir/include"
+        LDFLAGS="$LDFLAGS -L$dir/lib"
        LIBS="$LIBS $ac_krblibs $libk5crypto"
         with_kerberos5=$dir
         break
@@ -569,7 +609,7 @@
 then
   AS_MESSAGE(checking kerberosIV for `uname`...)
   KERBEROS_V4=1
-  CEFLAGS="$CEFLAGS -I/usr/include/kerberosIV"
+  CFLAGS="$CFLAGS -I/usr/include/kerberosIV"
   case `uname` in
       NetBSD)  LIBS="$LIBS -lkrb -ldes -lroken -lcom_err" ;;
       OpenBSD) LIBS="$LIBS -lkrb -ldes" ;;
@@ -578,7 +618,7 @@
   krb4_prefix=`krb4-config --prefix`
   AC_MSG_RESULT([krb4-config points to kerberosIV under $krb4_prefix])
   unset krb4_prefix
-  CEFLAGS="$CEFLAGS `krb4-config --cflags`"
+  CFLAGS="$CFLAGS `krb4-config --cflags`"
   LIBS="$LIBS `krb4-config --libs`"
   KERBEROS_V4=1
 elif krb5-config 2> /dev/null >/dev/null ; then
@@ -588,7 +628,7 @@
     AC_DEFINE(KERBEROS_V4_V5,1,Define if you have Kerberos V4 headers under a kerberosIV directory)
   fi
   unset krb4_prefix
-  CEFLAGS="$CEFLAGS `krb5-config --cflags krb4`"
+  CFLAGS="$CFLAGS `krb5-config --cflags krb4`"
   LIBS="$LIBS `krb5-config --libs krb4`"
   KERBEROS_V4=1
 else
@@ -631,8 +671,8 @@
      fi
      KERBEROS_V4=1
      test -f "$with_kerberos5/roken.h" && AC_DEFINE(HEIMDAL)
-     test "$dir" != "/usr/include" && CEFLAGS="$CEFLAGS -I$dir"
-     LDEFLAGS="$LDEFLAGS -L$with_kerberos/lib"
+     test "$dir" != "/usr/include" && CFLAGS="$CFLAGS -I$dir"
+     LDFLAGS="$LDFLAGS -L$with_kerberos/lib"
      break
   done
   if test -z "$with_kerberos" ; then
@@ -695,22 +735,22 @@
   then
     ###	ssl.h found under openssl.  Use openssl configuration preferentially,
     AC_MSG_NOTICE(Enabling OpenSSL support in $with_ssl.)
-    test "$with_ssl" != "/usr" && CEFLAGS="$CEFLAGS -I$with_ssl/include"
+    test "$with_ssl" != "/usr" && CFLAGS="$CFLAGS -I$with_ssl/include"
     ### In Red Hat 9, this file includes a reference to <krb5.h>, so we
     ### force the Kerberos direcory onto the include path so it will build.
-    CEFLAGS="$CEFLAGS -I/usr/kerberos/include"
+    CFLAGS="$CFLAGS -I/usr/kerberos/include"
     ###	OpenBSD comes with ssl headers
   else
     AC_MSG_ERROR([SSL support enabled, but OpenSSL not found])
   fi
-  LDEFLAGS="$LDEFLAGS -L$with_ssl/lib"
+  LDFLAGS="$LDFLAGS -L$with_ssl/lib"
   LIBS="$LIBS -lssl -lcrypto"
   dnl check if -ldl is needed
   AC_MSG_CHECKING([for additional library dependencies of SSL])
   found=0
   save_LIBS="$LIBS"
   for i in "" "-ldl" ; do
-      LIBS="$LDEFLAGS $save_LIBS $i"
+      LIBS="$LDFLAGS $save_LIBS $i"
       AC_LINK_IFELSE([AC_LANG_PROGRAM(,[SSL_library_init()])],[found=1; break])
   done
   if test $found = 0 ; then
@@ -734,13 +774,13 @@
 then
     if test "$with_socks" != yes
     then
-        LDEFLAGS="$LDEFLAGS -L$with_socks"
+        LDFLAGS="$LDFLAGS -L$with_socks"
     else
         AC_CHECK_LIB(socks, Rconnect,,
                AC_MSG_ERROR([could not find libsocks which is needed for built-in SOCKS support]))
     fi
     AC_DEFINE(HAVE_SOCKS,1,Define if you want built-in SOCKS support)
-    CEFLAGS="$CEFLAGS -Dconnect=Rconnect -Dgetsockname=Rgetsockname -Dbind=Rbind -Daccept=Raccept -Dlisten=Rlisten -Dselect=Rselect"
+    CFLAGS="$CFLAGS -Dconnect=Rconnect -Dgetsockname=Rgetsockname -Dbind=Rbind -Daccept=Raccept -Dlisten=Rlisten -Dselect=Rselect"
     LIBS="-lsocks $LIBS"
 fi])
 
@@ -752,14 +792,14 @@
 then
   if test "$with_socks5" != yes
   then
-    LDEFLAGS="$LDEFLAGS -L$with_socks5"
+    LDFLAGS="$LDFLAGS -L$with_socks5"
   fi
   ac_savedLDFLAGS="$LDFLAGS"
-  LDFLAGS="$LDEFLAGS $LDFLAGS"
+  LDFLAGS="$LDFLAGS $LDFLAGS"
   AC_CHECK_LIB(socks5, SOCKSconnect,,
   	AC_MSG_ERROR([could not find libsocks5 which is needed for built-in SOCKS5 support]))
   AC_DEFINE(HAVE_SOCKS)
-  CEFLAGS="$CEFLAGS -Dconnect=SOCKSconnect -Dgetsockname=SOCKSgetsockname -Dbind=SOCKSbind -Daccept=SOCKSaccept -Dlisten=SOCKSlisten -Dselect=SOCKSselect -Drecvfrom=SOCKSrecvfrom -Dsendto=SOCKSsendto -Drecv=SOCKSrecv -Dsend=SOCKSsend -Dread=SOCKSread -Dwrite=SOCKSwrite -Drresvport=SOCKSrresvport -Dshutdown=SOCKSshutdown -Dlisten=SOCKSlisten -Dclose=SOCKSclose -Ddup=SOCKSdup -Ddup2=SOCKSdup2 -Dgethostbyname=SOCKSgethostbyname"
+  CFLAGS="$CFLAGS -Dconnect=SOCKSconnect -Dgetsockname=SOCKSgetsockname -Dbind=SOCKSbind -Daccept=SOCKSaccept -Dlisten=SOCKSlisten -Dselect=SOCKSselect -Drecvfrom=SOCKSrecvfrom -Dsendto=SOCKSsendto -Drecv=SOCKSrecv -Dsend=SOCKSsend -Dread=SOCKSread -Dwrite=SOCKSwrite -Drresvport=SOCKSrresvport -Dshutdown=SOCKSshutdown -Dlisten=SOCKSlisten -Dclose=SOCKSclose -Ddup=SOCKSdup -Ddup2=SOCKSdup2 -Dgethostbyname=SOCKSgethostbyname"
   AC_CHECK_FUNC(SOCKSfclose, [CFLAGS="$CFLAGS -Dfclose=SOCKSfclose"])
   LDFLAGS="$ac_savedLDFLAGS"
 fi])
@@ -816,7 +856,7 @@
   fi
   AC_DEFINE(GSSAPI,1,Define if you want GSSAPI authentication)
   if test "$with_gssapi" != yes ; then
-    CPPFLAGS="-I$with_gssapi/include"
+    CPPFLAGS="$CPPFLAGS-I$with_gssapi/include"
   fi
   AC_CHECK_HEADERS(gss.h gssapi.h gssapi/gssapi.h gssapi/gssapi_generic.h)
   if test "$ac_cv_header_gssapi_h" = "yes"; then
@@ -826,10 +866,6 @@
   fi
 fi])
 
-AC_SUBST(CPFLAGS)
-AC_SUBST(CEFLAGS)
-AC_SUBST(LDEFLAGS)
-
 dnl ,------------------------------------------------------------------
 dnl Check if we need TRIO
 needtrio=0

Modified: branches/BRANCH_6-3/libesmtp/gethostbyname.c
===================================================================
--- branches/BRANCH_6-3/libesmtp/gethostbyname.c	2007-12-26 14:18:17 UTC (rev 5144)
+++ branches/BRANCH_6-3/libesmtp/gethostbyname.c	2007-12-26 14:37:09 UTC (rev 5145)
@@ -201,7 +201,7 @@
 #else
 
 void
-free_ghbnctx (struct ghbnctx *ctx __attribute__ ((unused)))
+free_ghbnctx (struct ghbnctx *ctx )
 {
   assert (ctx != NULL);
 }

Modified: branches/BRANCH_6-3/m4/gethostbyname_r.m4
===================================================================
--- branches/BRANCH_6-3/m4/gethostbyname_r.m4	2007-12-26 14:18:17 UTC (rev 5144)
+++ branches/BRANCH_6-3/m4/gethostbyname_r.m4	2007-12-26 14:37:09 UTC (rev 5145)
@@ -17,7 +17,7 @@
 AC_DEFUN([ACX_WHICH_GETHOSTBYNAME_R],
 [AC_CACHE_CHECK(number of arguments to gethostbyname_r,
                 acx_which_gethostbyname_r, [
-	AC_TRY_COMPILE([
+	AC_TRY_LINK([
 #		include <netdb.h> 
   	], 	[
 
@@ -29,7 +29,7 @@
 		],acx_which_gethostbyname_r=3, 
 			[
 dnl			acx_which_gethostbyname_r=0
-  AC_TRY_COMPILE([
+  AC_TRY_LINK([
 #   include <netdb.h>
   ], [
 	char *name;
@@ -42,7 +42,7 @@
   
   [
 dnl  acx_which_gethostbyname_r=0
-  AC_TRY_COMPILE([
+  AC_TRY_LINK([
 #   include <netdb.h>
   ], [
 			char *name;

Modified: branches/BRANCH_6-3/smbencrypt.c
===================================================================
--- branches/BRANCH_6-3/smbencrypt.c	2007-12-26 14:18:17 UTC (rev 5144)
+++ branches/BRANCH_6-3/smbencrypt.c	2007-12-26 14:37:09 UTC (rev 5145)
@@ -35,8 +35,8 @@
 
 #ifndef _AIX
 typedef unsigned char uchar;
+typedef signed short int16;
 #endif
-typedef signed short int16;
 typedef int BOOL;
 #define False 0
 #define True  1



From svn at mknod.org  Wed Dec 26 15:45:19 2007
From: svn at mknod.org (svn at mknod.org)
Date: Wed, 26 Dec 2007 08:45:19 -0600 (CST)
Subject: [fetchmail-svn] r5146 - branches/BRANCH_6-3
Message-ID: <20071226144519.F2BBB6B0CCE@mknod.org>

Author: m-a
Date: 2007-12-26 08:45:19 -0600 (Wed, 26 Dec 2007)
New Revision: 5146

Modified:
   branches/BRANCH_6-3/NEWS
   branches/BRANCH_6-3/configure.ac
Log:
Revise getnameinfo check to ensure NULL is defined and the result is properly
evaluated, to avoid bogus results on for instance FreeBSD and redefinitions of
NI_* at compile time.

Modified: branches/BRANCH_6-3/NEWS
===================================================================
--- branches/BRANCH_6-3/NEWS	2007-12-26 14:37:09 UTC (rev 5145)
+++ branches/BRANCH_6-3/NEWS	2007-12-26 14:45:19 UTC (rev 5146)
@@ -85,6 +85,9 @@
   was also changed to reflect this. (Peter O'Gorman)
 * m4/gethostbyname_r.m4 does AC_TRY_COMPILE, which unfortunately can pass even
   if there is no gethostbyname_r. Changed to AC_TRY_LINK. (Peter O'Gorman)
+* Revise getnameinfo check to ensure NULL is defined and the result is properly
+  evaluated, to avoid bogus results on for instance FreeBSD and redefinitions of
+  NI_* at compile time. (Matthias Andree).
 * __attribute__ ((unused)) is a gccism, removed from libesmtp/gethostbyname.c.
   (Peter O'Gorman)
 * In KAME/getnameinfo.c it's best to use the correct argument to inet_ntoa.

Modified: branches/BRANCH_6-3/configure.ac
===================================================================
--- branches/BRANCH_6-3/configure.ac	2007-12-26 14:37:09 UTC (rev 5145)
+++ branches/BRANCH_6-3/configure.ac	2007-12-26 14:45:19 UTC (rev 5146)
@@ -467,10 +467,16 @@
 #ifdef HAVE_NETDB_H
 #include <netdb.h>
 #endif
+#ifndef NULL
+#define NULL ((void *)0)
+#endif
   ], [getnameinfo(NULL,0, NULL,0, NULL, 0, 0);],
     [ fm_cv_getnameinfo=yes],
     [ fm_cv_getnameinfo=no ])
 ])
+if test $fm_cv_getnameinfo = yes ; then
+    AC_DEFINE(HAVE_GETNAMEINFO,1,[Define to 1 if your system has getnameinfo()])
+fi
 
 AM_CONDITIONAL(NEED_GETADDRINFO, test "$fm_cv_getaddrinfo" != yes)
 AM_CONDITIONAL(NEED_GETNAMEINFO, test "$fm_cv_getnameinfo"   != yes)



From svn at mknod.org  Thu Dec 27 00:24:33 2007
From: svn at mknod.org (svn at mknod.org)
Date: Wed, 26 Dec 2007 17:24:33 -0600 (CST)
Subject: [fetchmail-svn] r5147 - branches/BRANCH_6-3
Message-ID: <20071226232433.25CA16B0CD6@mknod.org>

Author: m-a
Date: 2007-12-26 17:24:32 -0600 (Wed, 26 Dec 2007)
New Revision: 5147

Modified:
   branches/BRANCH_6-3/NEWS
   branches/BRANCH_6-3/TODO.txt
   branches/BRANCH_6-3/imap.c
Log:
Fix Berlios Bug #11797, imap_mark_seen doesn't consider expunged messages
(and marks the wrong messages seen after expunges, leading to data loss in
'keep flush' configurations). Report and patch by Alexander Cherepanov. Thanks\!

Modified: branches/BRANCH_6-3/NEWS
===================================================================
--- branches/BRANCH_6-3/NEWS	2007-12-26 14:45:19 UTC (rev 5146)
+++ branches/BRANCH_6-3/NEWS	2007-12-26 23:24:32 UTC (rev 5147)
@@ -52,9 +52,15 @@
   fetchmail by default talks SMTP to the localhost, so the overall risk is
   rather low.
   This bug was apparently introduced on 1998-11-27 when the bouncemail facility
-  was modularized. The bug made then its appearance in fetchmail release 4.6.8.
+  was modularized. The bug then made its appearance in fetchmail release 4.6.8.
   See also fetchmail-SA-2007-02.txt.
 
+# CRITICAL BUG FIX:
+* When expunging, mark the right messages as seen to avoid message loss in "keep
+  flush" configurations.  Workaround for previous versions: "expunge 0".
+  Report and patch by Alexander Cherepanov - thanks a lot, Berlios Bug #11797,
+  "imap_mark_seen doesn't consider expunged messages".
+
 # BUG FIXES:
 * The configure script will additionally check for 'dn_skipname', to fix build
   failures with ?Clibc. The new check still recognizes the resolver libraries on

Modified: branches/BRANCH_6-3/TODO.txt
===================================================================
--- branches/BRANCH_6-3/TODO.txt	2007-12-26 14:45:19 UTC (rev 5146)
+++ branches/BRANCH_6-3/TODO.txt	2007-12-26 23:24:32 UTC (rev 5147)
@@ -1,5 +1,4 @@
 soon - MUST:
-- BerliOS Bug #11797, imap_mark_seen doesn't consider expunged messages
 - BerliOS Bug #10972, Fetchmail refetches big messages repeatedly (SMTP listener
   issue)
 - report multiline SMTP errors properly (sample in private mail from 

Modified: branches/BRANCH_6-3/imap.c
===================================================================
--- branches/BRANCH_6-3/imap.c	2007-12-26 14:45:19 UTC (rev 5146)
+++ branches/BRANCH_6-3/imap.c	2007-12-26 23:24:32 UTC (rev 5147)
@@ -1240,6 +1240,10 @@
 /* mark the given message as seen */
 {
     (void)ctl;
+
+    /* expunges change the message numbers */
+    number -= expunged;
+
     return(gen_transact(sock,
 	imap_version == IMAP4
 	? "STORE %d +FLAGS.SILENT (\\Seen)"



From svn at mknod.org  Sun Dec 30 23:07:01 2007
From: svn at mknod.org (svn at mknod.org)
Date: Sun, 30 Dec 2007 16:07:01 -0600 (CST)
Subject: [fetchmail-svn] r5148 - branches/BRANCH_6-3
Message-ID: <20071230220701.9302D6B0CD0@mknod.org>

Author: m-a
Date: 2007-12-30 16:07:01 -0600 (Sun, 30 Dec 2007)
New Revision: 5148

Modified:
   branches/BRANCH_6-3/TODO.txt
Log:
BerliOS #10972 contains insufficient information, but it looks like the problem
is outside fetchmail. Drop.

Modified: branches/BRANCH_6-3/TODO.txt
===================================================================
--- branches/BRANCH_6-3/TODO.txt	2007-12-26 23:24:32 UTC (rev 5147)
+++ branches/BRANCH_6-3/TODO.txt	2007-12-30 22:07:01 UTC (rev 5148)
@@ -1,6 +1,4 @@
 soon - MUST:
-- BerliOS Bug #10972, Fetchmail refetches big messages repeatedly (SMTP listener
-  issue)
 - report multiline SMTP errors properly (sample in private mail from 
   Earl Chew, 2007-07-30T02:28)
 - publish SA-2007-02 after release



From svn at mknod.org  Mon Dec 31 10:11:56 2007
From: svn at mknod.org (svn at mknod.org)
Date: Mon, 31 Dec 2007 03:11:56 -0600 (CST)
Subject: [fetchmail-svn] r5149 - branches/BRANCH_6-3
Message-ID: <20071231091156.1A1CE6B0CD0@mknod.org>

Author: m-a
Date: 2007-12-31 03:11:55 -0600 (Mon, 31 Dec 2007)
New Revision: 5149

Modified:
   branches/BRANCH_6-3/TODO.txt
Log:
Revert dropping BerliOS bug #10972 at user's insistence and further explanation

Modified: branches/BRANCH_6-3/TODO.txt
===================================================================
--- branches/BRANCH_6-3/TODO.txt	2007-12-30 22:07:01 UTC (rev 5148)
+++ branches/BRANCH_6-3/TODO.txt	2007-12-31 09:11:55 UTC (rev 5149)
@@ -1,4 +1,6 @@
 soon - MUST:
+- BerliOS Bug #10972, Fetchmail refetches big messages repeatedly (SMTP listener
+  issue)
 - report multiline SMTP errors properly (sample in private mail from 
   Earl Chew, 2007-07-30T02:28)
 - publish SA-2007-02 after release



